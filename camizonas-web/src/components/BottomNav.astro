---
interface Props {
    currentPath?: string;
}

const { currentPath = Astro.url.pathname } = Astro.props;

function isActive(path: string, current: string) {
    if (path === '/' && current === '/') return true;
    if (path !== '/' && current.startsWith(path)) return true;
    return false;
}
---

<!-- ✅ CAMBIO: Removido max-w-[375px] para que ocupe todo el ancho -->
<div class="fixed bottom-0 left-0 w-full h-20 bg-white/95 backdrop-blur-lg border-t border-gray-100 flex justify-around items-center z-[60] md:hidden shadow-[0_-4px_20px_rgba(0,0,0,0.08)]">
  
  <!-- INICIO -->
  <a 
    href="/" 
    class={`flex flex-col items-center gap-1 hover:scale-110 transition-all duration-300 group p-3 rounded-2xl ${
      isActive('/', currentPath) 
        ? 'text-black bg-black/5' 
        : 'text-gray-400 hover:text-gray-600 hover:bg-gray-50'
    }`}
  >
    <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class={`transition-colors ${isActive('/', currentPath) ? 'stroke-black' : 'group-hover:stroke-blue-600'}`}>
      <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
      <polyline points="9 22 9 12 15 12 15 22"/>
    </svg>
    <span class="text-[11px] font-bold uppercase tracking-wide">Inicio</span>
    {isActive('/', currentPath) && (
      <div class="w-8 h-1 bg-black rounded-full absolute bottom-1 animate-pulse"></div>
    )}
  </a>

  <!-- CATÁLOGO -->
  <a 
    href="/catalogo" 
    class={`flex flex-col items-center gap-1 hover:scale-110 transition-all duration-300 group p-3 rounded-2xl ${
      isActive('/catalogo', currentPath) 
        ? 'text-black bg-black/5' 
        : 'text-gray-400 hover:text-gray-600 hover:bg-gray-50'
    }`}
  >
    <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class={`transition-colors ${isActive('/catalogo', currentPath) ? 'stroke-black' : 'group-hover:stroke-blue-600'}`}>
      <rect width="7" height="7" x="3" y="3" rx="1"/>
      <rect width="7" height="7" x="14" y="3" rx="1"/>
      <rect width="7" height="7" x="3" y="14" rx="1"/>
      <rect width="7" height="7" x="14" y="14" rx="1"/>
    </svg>
    <span class="text-[11px] font-bold uppercase tracking-wide">Catálogo</span>
    {isActive('/catalogo', currentPath) && (
      <div class="w-8 h-1 bg-black rounded-full absolute bottom-1 animate-pulse"></div>
    )}
  </a>

  <!-- CARRITO -->
  <a 
    href="/carrito" 
    class={`flex flex-col items-center gap-1 hover:scale-110 transition-all duration-300 group p-3 rounded-2xl relative ${
      isActive('/carrito', currentPath) 
        ? 'text-black bg-black/5' 
        : 'text-gray-400 hover:text-gray-600 hover:bg-gray-50'
    }`}
  >
    <div class="relative">
      <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class={`transition-colors ${isActive('/carrito', currentPath) ? 'stroke-black' : 'group-hover:stroke-blue-600'}`}>
        <circle cx="8" cy="21" r="1"/>
        <circle cx="19" cy="21" r="1"/>
        <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>
      </svg>
      <span id="cart-badge" class="hidden absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center shadow-lg animate-bounce">0</span>
    </div>
    <span class="text-[11px] font-bold uppercase tracking-wide">Carrito</span>
    {isActive('/carrito', currentPath) && (
      <div class="w-8 h-1 bg-black rounded-full absolute bottom-1 animate-pulse"></div>
    )}
  </a>

</div>

<script>
  function updateCartBadge() {
    const carrito = JSON.parse(localStorage.getItem('carrito') || '[]');
    const badge = document.getElementById('cart-badge');
    
    if (badge) {
      if (carrito.length > 0) {
        badge.textContent = carrito.length;
        badge.classList.remove('hidden');
        badge.classList.add('animate-pulse');
        setTimeout(() => badge.classList.remove('animate-pulse'), 1000);
      } else {
        badge.classList.add('hidden');
      }
    }
  }

  document.addEventListener('DOMContentLoaded', updateCartBadge);
  window.addEventListener('storage', updateCartBadge);
  window.addEventListener('cartUpdated', updateCartBadge);
  setInterval(updateCartBadge, 2000);
</script>