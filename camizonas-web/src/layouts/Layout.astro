---
import '../styles/global.css';
import BottomNav from '../components/BottomNav.astro';
import Toast from '../components/Toast.astro';
import ConfirmModal from '../components/ConfirmModal.astro';
import Footer from '../components/Footer.astro';
import { ViewTransitions } from 'astro:transitions';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  url?: string;
  showBackButton?: boolean;
  breadcrumbs?: Array<{ label: string; href: string }>;
}

const { 
  title = 'CamiZonas | Camisetas de F√∫tbol Premium',
  description = 'Las mejores camisetas de f√∫tbol con personalizaci√≥n gratis. Env√≠o a toda Guatemala.',
  image = 'https://camizonas.com/img/og-image.webp',
  url = 'https://camizonas.com',
  showBackButton = false,
  breadcrumbs = []
} = Astro.props;

const currentPath = Astro.url.pathname;
const isProductPage = currentPath.startsWith('/producto/');
const isHomePage = currentPath === '/';
---

<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{title}</title>
  <meta name="description" content={description} />
  
  <!-- ‚úÖ Open Graph Mejorado -->
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:image" content={image} />
  <meta property="og:url" content={url} />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="CamiZonas" />
  <meta property="og:locale" content="es_GT" />
  
  <!-- ‚úÖ Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={image} />
  
  <!-- ‚úÖ SEO Adicional -->
  <meta name="keywords" content="camisetas de f√∫tbol, camisetas deportivas, Guatemala, personalizaci√≥n gratis, env√≠o nacional" />
  <meta name="author" content="CamiZonas" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href={url} />
  
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  
  <!-- ‚úÖ Preconnect para fuentes con font-display: swap -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />

  <ViewTransitions />
</head>
<body class="antialiased bg-white text-gray-900 overflow-x-hidden">
    
  <Toast />
  <ConfirmModal />
  
  <div id="flying-item" class="fixed pointer-events-none z-[200] opacity-0 transition-all duration-700 ease-in-out">
    <div class="w-16 h-16 bg-black rounded-2xl shadow-2xl flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
        <circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/>
        <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>
      </svg>
    </div>
  </div>

  <nav class="sticky top-0 z-50 bg-white/95 backdrop-blur-md border-b border-gray-100 transition-all duration-300">
    <div class="max-w-7xl mx-auto px-4 md:px-8 lg:px-12 py-4">
      <div class="flex justify-between items-center">
        
        {isProductPage || showBackButton ? (
          <a href="javascript:history.back()" class="w-10 h-10 bg-gray-50 hover:bg-gray-100 rounded-full flex items-center justify-center transition-colors border border-gray-200">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m15 18-6-6 6-6"/></svg>
          </a>
        ) : (
          <div class="w-10 h-10 hidden md:block"></div>
        )}
        
        <a href="/" class="text-2xl sm:text-3xl font-black italic tracking-tighter hover:scale-105 transition-transform">
          CAMIZONAS.
        </a>
        
        <nav class="hidden md:flex items-center gap-6 lg:gap-8">
          <a href="/" class={`text-sm font-bold transition-colors ${isHomePage ? 'text-black' : 'text-gray-500 hover:text-black'}`}>Inicio</a>
          <a href="/catalogo" class="text-sm font-bold text-gray-500 hover:text-black transition-colors">Cat√°logo</a>
          <a href="/catalogo?categoria=Clubes" class="text-sm font-bold text-gray-500 hover:text-black transition-colors">Clubes</a>
          <a href="/catalogo?categoria=Selecciones" class="text-sm font-bold text-gray-500 hover:text-black transition-colors">Selecciones</a>
          <a href="/carrito" class="relative flex items-center gap-2 bg-black text-white px-5 py-2.5 rounded-full font-bold text-sm hover:bg-gray-800 transition-colors hover:shadow-lg hover:shadow-black/20">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
            Carrito
            <span id="cart-badge-nav" class="hidden bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center absolute -top-1 -right-1 animate-bounce">0</span>
          </a>
          
          <button id="menu-toggle-desktop" class="w-10 h-10 bg-white border border-gray-100 shadow-sm rounded-full flex flex-col items-center justify-center gap-[5px] hover:bg-black group transition-all duration-300">
            <span class="w-5 h-0.5 bg-black group-hover:bg-white transition-colors rounded-full"></span>
            <span class="w-5 h-0.5 bg-black group-hover:bg-white transition-colors rounded-full"></span>
            <span class="w-5 h-0.5 bg-black group-hover:bg-white transition-colors rounded-full"></span>
          </button>
        </nav>
        
        <button id="menu-toggle" class="md:hidden w-10 h-10 bg-white border border-gray-100 shadow-sm rounded-full flex flex-col items-center justify-center gap-[5px] hover:bg-black group transition-all duration-300 active:scale-95">
          <span class="w-5 h-0.5 bg-black group-hover:bg-white transition-colors rounded-full"></span>
          <span class="w-5 h-0.5 bg-black group-hover:bg-white transition-colors rounded-full"></span>
          <span class="w-5 h-0.5 bg-black group-hover:bg-white transition-colors rounded-full"></span>
        </button>
      </div>
      
      {breadcrumbs.length > 0 && (
        <nav class="mt-3 flex items-center gap-2 text-xs text-gray-400 overflow-x-auto no-scrollbar">
          <a href="/" class="hover:text-black transition-colors whitespace-nowrap">Inicio</a>
          {breadcrumbs.map((crumb, index) => (
            <>
              <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m9 18 6-6-6-6"/></svg>
              {index === breadcrumbs.length - 1 ? (
                <span class="text-black font-medium truncate max-w-[200px]">{crumb.label}</span>
              ) : (
                <a href={crumb.href} class="hover:text-black transition-colors whitespace-nowrap">{crumb.label}</a>
              )}
            </>
          ))}
        </nav>
      )}
    </div>
  </nav>

  <div id="side-menu-overlay" class="fixed inset-0 bg-black/20 z-[55] hidden backdrop-blur-sm transition-opacity opacity-0"></div>

  <aside id="side-menu" class="fixed top-0 right-0 h-full w-3/4 max-w-xs bg-white z-[60] shadow-2xl transform translate-x-full transition-transform duration-300 ease-out flex flex-col p-6 sm:p-8">
    <div class="flex justify-end mb-8">
      <button id="menu-close" class="text-3xl font-light hover:rotate-90 transition-transform w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-50">‚úï</button>
    </div>
    
    <div class="flex flex-col gap-8">
      <nav class="flex flex-col gap-5 text-lg font-bold">
        <a href="/" class="flex items-center gap-3 hover:text-orange-500 transition-colors group">
          <span class="group-hover:scale-110 transition-transform">üè†</span> Inicio
        </a>
        <a href="/catalogo" class="flex items-center gap-3 hover:text-orange-500 transition-colors group">
          <span class="group-hover:scale-110 transition-transform">üì¶</span> Cat√°logo
        </a>
        <a href="/carrito" class="flex items-center gap-3 hover:text-orange-500 transition-colors group">
          <span class="group-hover:scale-110 transition-transform">üõí</span> Carrito
        </a>
      </nav>

      <div class="border-t border-gray-100 pt-6">
        <h3 class="text-xs font-black text-gray-400 uppercase tracking-widest mb-4">Ayuda</h3>
        <nav class="flex flex-col gap-4 text-base font-medium text-gray-600">
          <button id="open-tallas-modal" class="text-left hover:text-orange-500 transition-colors flex items-center gap-2 w-full">
            üìè Gu√≠a de Tallas
          </button>
          <button id="open-envios-modal" class="text-left hover:text-orange-500 transition-colors flex items-center gap-2 w-full">
            üöö Env√≠os
          </button>
          <button id="open-faq-modal" class="text-left hover:text-orange-500 transition-colors flex items-center gap-2 w-full">
            ‚ùì FAQ
          </button>
        </nav>
      </div>

      <div class="mt-auto pt-6 border-t border-gray-100">
        <a href="https://wa.me/50232650539" class="bg-black text-white py-4 rounded-xl flex justify-center items-center gap-2 font-bold text-sm hover:bg-gray-900 transition-all shadow-lg shadow-black/10 hover:shadow-xl hover:translate-y-[-2px]">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20" fill="#25D366">
            <path d="M12 2C6.486 2 2 6.486 2 12c0 1.994.574 3.84 1.566 5.396L2 22l4.78-1.538A9.93 9.93 0 0 0 12 22c5.514 0 10-4.486 10-10S17.514 2 12 2zm0 18.182a8.13 8.13 0 0 1-4.144-1.127l-.297-.176-2.834.911.923-2.761-.194-.306A8.126 8.126 0 1 1 12 20.182zm4.47-5.693c-.244-.122-1.444-.713-1.667-.794-.223-.082-.386-.122-.549.122-.163.245-.632.794-.774.958-.142.163-.284.183-.528.061-.244-.122-1.03-.38-1.96-1.21-.724-.646-1.212-1.444-1.354-1.688-.142-.244-.015-.375.107-.497.11-.11.244-.285.366-.427.122-.143.163-.244.244-.407.081-.163.041-.305-.02-.427-.061-.122-.549-1.326-.752-1.815-.198-.476-.399-.412-.549-.42-.142-.007-.305-.009-.467-.009-.163 0-.427.061-.651.305-.223.244-.854.834-.854 2.034s.875 2.36.997 2.523c.122.163 1.72 2.628 4.168 3.684.582.251 1.037.401 1.391.513.584.186 1.115.16 1.535.097.468-.07 1.444-.591 1.647-1.163.203-.571.203-1.061.142-1.163-.061-.102-.223-.163-.467-.285z"/>
          </svg>
          WhatsApp
        </a>
      </div>
    </div>
  </aside>

  <!-- MODALES (tallas, env√≠os, faq) - mantengo igual -->
  <div id="tallas-modal" class="fixed inset-0 z-[100] hidden items-center justify-center p-4 bg-black/50 backdrop-blur-sm transition-opacity duration-300">
    <div class="bg-white rounded-3xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl animate-fade-in-scale">
      <div class="sticky top-0 bg-white p-4 border-b border-gray-100 flex justify-between items-center rounded-t-3xl z-10">
        <h2 class="text-lg font-black">üìè Gu√≠a de Tallas</h2>
        <button id="close-tallas-modal" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
      </div>
      
      <div class="p-5 space-y-5">
        <div class="bg-orange-50 border border-orange-200 rounded-xl p-4">
          <p class="text-sm text-orange-800">
            <span class="font-bold">üí° Tip:</span> Si est√°s entre dos tallas, te recomendamos elegir la m√°s grande para mayor comodidad.
          </p>
        </div>

        <div>
          <h3 class="font-bold text-sm mb-3 text-gray-700">Seg√∫n tu altura y peso:</h3>
          <div class="overflow-x-auto">
            <table class="w-full text-xs border-collapse">
              <thead>
                <tr class="bg-gray-100">
                  <th class="p-2 text-left rounded-tl-lg font-bold">Talla</th>
                  <th class="p-2 text-center font-bold">Altura</th>
                  <th class="p-2 text-center font-bold">Peso</th>
                  <th class="p-2 text-center rounded-tr-lg font-bold">Pecho</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-200">
                <tr class="hover:bg-gray-50">
                  <td class="p-2 font-bold">S</td>
                  <td class="p-2 text-center">1.60 - 1.70 m</td>
                  <td class="p-2 text-center">60 - 70 kg</td>
                  <td class="p-2 text-center">88 - 92 cm</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="p-2 font-bold">M</td>
                  <td class="p-2 text-center">1.68 - 1.78 m</td>
                  <td class="p-2 text-center">70 - 80 kg</td>
                  <td class="p-2 text-center">92 - 100 cm</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="p-2 font-bold">L</td>
                  <td class="p-2 text-center">1.75 - 1.85 m</td>
                  <td class="p-2 text-center">80 - 90 kg</td>
                  <td class="p-2 text-center">100 - 108 cm</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="p-2 font-bold">XL</td>
                  <td class="p-2 text-center">1.83 - 1.93 m</td>
                  <td class="p-2 text-center">90 - 95 kg</td>
                  <td class="p-2 text-center">108 - 112 cm</td>
                </tr>
                <tr class="hover:bg-gray-50">
                  <td class="p-2 font-bold rounded-bl-lg">XXL</td>
                  <td class="p-2 text-center">1.88+ m</td>
                  <td class="p-2 text-center">95+ kg</td>
                  <td class="p-2 text-center rounded-br-lg">112+ cm</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="bg-gray-50 rounded-xl p-4 space-y-3">
          <h3 class="font-bold text-sm text-gray-700">Diferencia de corte:</h3>
          <div class="space-y-2 text-xs">
            <div class="flex gap-3 items-start">
              <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded font-bold">FAN</span>
              <p class="text-gray-600">Corte <span class="font-bold">recto y holgado</span>. Ideal para uso diario. Si quieres comodidad, elige tu talla normal.</p>
            </div>
            <div class="flex gap-3 items-start">
              <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded font-bold">JUGADOR</span>
              <p class="text-gray-600">Corte <span class="font-bold">ajustado al cuerpo</span> (slim fit). Si prefieres holgura, sube una talla.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="envios-modal" class="fixed inset-0 z-[100] hidden items-center justify-center p-4 bg-black/50 backdrop-blur-sm transition-opacity duration-300">
    <div class="bg-white rounded-3xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl animate-fade-in-scale">
      <div class="sticky top-0 bg-white p-4 border-b border-gray-100 flex justify-between items-center rounded-t-3xl z-10">
        <h2 class="text-lg font-black">üöö Informaci√≥n de Env√≠os</h2>
        <button id="close-envios-modal" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
      </div>
      
      <div class="p-5 space-y-5">
        <div class="bg-green-50 border border-green-200 rounded-xl p-4 text-center">
          <p class="text-sm text-green-800 font-bold mb-1">üì¶ Env√≠o a toda Guatemala</p>
          <p class="text-xs text-green-700">Tiempo estimado: 2-4 d√≠as h√°biles</p>
        </div>

        <div class="space-y-3">
          <h3 class="font-bold text-sm text-gray-700">Costos de env√≠o (aproximados):</h3>
          <div class="grid grid-cols-2 gap-2 text-xs">
            <div class="bg-gray-50 p-3 rounded-lg">
              <p class="font-bold text-gray-700">Ciudad de Guatemala</p>
              <p class="text-gray-600">Q.25 - Q.35</p>
            </div>
            <div class="bg-gray-50 p-3 rounded-lg">
              <p class="font-bold text-gray-700">Interior del pa√≠s</p>
              <p class="text-gray-600">Q.35 - Q.50</p>
            </div>
          </div>
        </div>

        <div class="flex items-center gap-3 p-4 bg-blue-50 rounded-xl">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-blue-600 flex-shrink-0">
            <circle cx="12" cy="12" r="10"/>
            <line x1="12" y1="16" x2="12" y2="12"/>
            <line x1="12" y1="8" x2="12.01" y2="8"/>
          </svg>
          <p class="text-xs text-gray-700">El costo exacto se confirma por WhatsApp seg√∫n tu ubicaci√≥n.</p>
        </div>

        <a href="https://wa.me/50232650539?text=Hola,%20quiero%20saber%20el%20costo%20de%20env√≠o%20a%20mi%20zona:%20___" class="block w-full bg-black text-white text-center py-3 rounded-xl font-bold text-sm hover:bg-gray-800 transition-colors">
          Consultar costo exacto por WhatsApp
        </a>
      </div>
    </div>
  </div>

  <div id="faq-modal" class="fixed inset-0 z-[100] hidden items-center justify-center p-4 bg-black/50 backdrop-blur-sm transition-opacity duration-300">
    <div class="bg-white rounded-3xl max-w-lg w-full max-h-[90vh] overflow-y-auto shadow-2xl animate-fade-in-scale">
      <div class="sticky top-0 bg-white p-4 border-b border-gray-100 flex justify-between items-center rounded-t-3xl z-10">
        <h2 class="text-lg font-black">‚ùì Preguntas Frecuentes</h2>
        <button id="close-faq-modal" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
        </button>
      </div>
      
      <div class="p-5 space-y-4">
        <details class="group border border-gray-200 rounded-xl overflow-hidden transition-all duration-300 hover:shadow-sm">
          <summary class="flex justify-between items-center p-4 cursor-pointer font-bold text-sm hover:bg-gray-50 transition-colors select-none">
            ¬øLas camisetas son originales?
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="transform transition-transform duration-300 group-open:rotate-180"><path d="m6 9 6 6 6-6"/></svg>
          </summary>
          <div class="px-4 pb-4 text-sm text-gray-600 animate-fadeIn">
            Nuestras camisetas son r√©plicas de alta calidad AAA+. Tienen los mismos dise√±os, escudos y patrocinadores que las originales, con materiales premium que garantizan durabilidad y comodidad.
          </div>
        </details>

        <details class="group border border-gray-200 rounded-xl overflow-hidden transition-all duration-300 hover:shadow-sm">
          <summary class="flex justify-between items-center p-4 cursor-pointer font-bold text-sm hover:bg-gray-50 transition-colors select-none">
            ¬øPuedo personalizar con cualquier nombre?
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="transform transition-transform duration-300 group-open:rotate-180"><path d="m6 9 6 6 6-6"/></svg>
          </summary>
          <div class="px-4 pb-4 text-sm text-gray-600 animate-fadeIn">
            ¬°S√≠! Puedes poner el nombre y n√∫mero que quieras. Ya sea tu jugador favorito o tu propio nombre. La personalizaci√≥n tiene un costo adicional de Q.25.
          </div>
        </details>

        <details class="group border border-gray-200 rounded-xl overflow-hidden transition-all duration-300 hover:shadow-sm">
          <summary class="flex justify-between items-center p-4 cursor-pointer font-bold text-sm hover:bg-gray-50 transition-colors select-none">
            ¬øC√≥mo realizo mi pedido?
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="transform transition-transform duration-300 group-open:rotate-180"><path d="m6 9 6 6 6-6"/></svg>
          </summary>
          <div class="px-4 pb-4 text-sm text-gray-600 animate-fadeIn">
            1. Elige tu camiseta y personalizaci√≥n<br>
            2. Haz clic en "Pedir por WhatsApp"<br>
            3. Confirma tu pedido con nosotros<br>
            4. Realiza el pago (transferencia o efectivo contra entrega)<br>
            5. ¬°Recibe tu camiseta en 2-4 d√≠as!
          </div>
        </details>

        <details class="group border border-gray-200 rounded-xl overflow-hidden transition-all duration-300 hover:shadow-sm">
          <summary class="flex justify-between items-center p-4 cursor-pointer font-bold text-sm hover:bg-gray-50 transition-colors select-none">
            ¬øAceptan cambios o devoluciones?
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="transform transition-transform duration-300 group-open:rotate-180"><path d="m6 9 6 6 6-6"/></svg>
          </summary>
          <div class="px-4 pb-4 text-sm text-gray-600 animate-fadeIn">
            Le recomendamos verificar cuidadosamente su pedido, ya que no se aceptan cambios ni devoluciones.
          </div>
        </details>

        <div class="pt-3">
          <a href="https://wa.me/50232650539?text=Hola,%20tengo%20una%20pregunta:%20" class="block w-full bg-black text-white text-center py-3 rounded-xl font-bold text-sm hover:bg-gray-800 transition-colors shadow-lg shadow-black/10">
            ¬øM√°s preguntas? Escr√≠benos
          </a>
        </div>
      </div>
    </div>
  </div>
  
  <slot />
  
  <!-- ‚úÖ Footer -->
  <Footer />
  
  <BottomNav currentPath={currentPath} />

  <script is:inline>
    // ‚úÖ FUNCI√ìN GLOBAL DE INICIALIZACI√ìN
    // Esta funci√≥n se ejecuta en la carga inicial Y en cada transici√≥n de p√°gina
    function initApp() {
        console.log("CamiZonas App Initialized");

        // --- MEN√ö LATERAL ---
        const toggleBtn = document.getElementById('menu-toggle');
        const toggleBtnDesktop = document.getElementById('menu-toggle-desktop');
        const closeBtn = document.getElementById('menu-close');
        const menu = document.getElementById('side-menu');
        const overlay = document.getElementById('side-menu-overlay');

        if(menu && overlay) {
            function openMenu() {
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
                menu.classList.remove('translate-x-full');
            }

            function closeMenuFn() {
                overlay.classList.add('opacity-0');
                menu.classList.add('translate-x-full');
                setTimeout(() => overlay.classList.add('hidden'), 300);
            }

            // Limpiamos eventos previos para evitar duplicados si Astro no limpia
            toggleBtn?.replaceWith(toggleBtn.cloneNode(true));
            toggleBtnDesktop?.replaceWith(toggleBtnDesktop.cloneNode(true));
            closeBtn?.replaceWith(closeBtn.cloneNode(true));
            overlay?.replaceWith(overlay.cloneNode(true));

            // Re-seleccionamos los elementos clonados
            document.getElementById('menu-toggle')?.addEventListener('click', openMenu);
            document.getElementById('menu-toggle-desktop')?.addEventListener('click', openMenu);
            document.getElementById('menu-close')?.addEventListener('click', closeMenuFn);
            document.getElementById('side-menu-overlay')?.addEventListener('click', closeMenuFn);

            // Exponer closeMenuFn globalmente para los modales
            window.closeSideMenu = closeMenuFn;
        }

        // --- MODALES ---
        function setupModal(openBtnId, modalId, closeBtnId) {
            const openBtn = document.getElementById(openBtnId);
            const modal = document.getElementById(modalId);
            const closeBtn = document.getElementById(closeBtnId);

            if(!openBtn || !modal) return;

            // Limpieza de eventos
            openBtn.replaceWith(openBtn.cloneNode(true));
            const newOpenBtn = document.getElementById(openBtnId);
            
            closeBtn?.replaceWith(closeBtn.cloneNode(true));
            const newCloseBtn = document.getElementById(closeBtnId);

            newOpenBtn?.addEventListener('click', () => {
                modal.classList.remove('hidden');
                modal.classList.add('flex');
            });

            newCloseBtn?.addEventListener('click', () => {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
            });

            // Click outside to close
            // El modal contenedor no se reemplaza, as√≠ que cuidado con duplicar eventos
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.classList.add('hidden');
                    modal.classList.remove('flex');
                }
            };
        }

        setupModal('open-tallas-modal', 'tallas-modal', 'close-tallas-modal');
        setupModal('open-envios-modal', 'envios-modal', 'close-envios-modal');
        setupModal('open-faq-modal', 'faq-modal', 'close-faq-modal');

        // --- CARRITO BADGE ---
        updateNavCartBadge();
        
        // ‚úÖ LAZY LOADING DE IM√ÅGENES
        setupLazyLoading();
    }

    // --- FUNCIONES UTILITARIAS ---
    function updateNavCartBadge() {
      const badge = document.getElementById('cart-badge-nav');
      if (!badge) return;
      
      const carrito = JSON.parse(localStorage.getItem('carrito') || '[]');
      const count = carrito.length;
      
      if (count > 0) {
        badge.textContent = count > 9 ? '9+' : count;
        badge.classList.remove('hidden');
      } else {
        badge.classList.add('hidden');
      }
    }

    // ‚úÖ LAZY LOADING MEJORADO
    function setupLazyLoading() {
      const lazyImages = document.querySelectorAll('img[loading="lazy"]');
      
      if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const img = entry.target;
              img.addEventListener('load', () => {
                img.classList.add('loaded');
              });
              observer.unobserve(img);
            }
          });
        });

        lazyImages.forEach(img => imageObserver.observe(img));
      } else {
        // Fallback para navegadores antiguos
        lazyImages.forEach(img => img.classList.add('loaded'));
      }
    }

    window.flyToCart = function(startElement) {
      const flyingItem = document.getElementById('flying-item');
      const cartIcon = document.querySelector('#cart-badge')?.parentElement || 
                       document.querySelector('a[href="/carrito"]');
      
      if (!flyingItem || !cartIcon || !startElement) return;

      const startRect = startElement.getBoundingClientRect();
      const endRect = cartIcon.getBoundingClientRect();

      flyingItem.style.left = `${startRect.left + startRect.width / 2 - 32}px`;
      flyingItem.style.top = `${startRect.top + startRect.height / 2 - 32}px`;
      flyingItem.style.transform = 'scale(1)';
      flyingItem.style.opacity = '1';

      flyingItem.offsetHeight; // Trigger reflow

      requestAnimationFrame(() => {
        flyingItem.style.left = `${endRect.left + endRect.width / 2 - 32}px`;
        flyingItem.style.top = `${endRect.top + endRect.height / 2 - 32}px`;
        flyingItem.style.transform = 'scale(0.3)';
        flyingItem.style.opacity = '0';
      });

      setTimeout(() => {
        flyingItem.style.opacity = '0';
        flyingItem.style.transform = 'scale(1)';
      }, 700);
    };

    // ‚úÖ EJECUTAR EN CARGA INICIAL Y TRANSICIONES
    document.addEventListener('astro:page-load', initApp);
    
    // Listeners globales que no necesitan reinicializarse
    window.addEventListener('cartUpdated', updateNavCartBadge);
    window.addEventListener('storage', updateNavCartBadge);
  </script>
</body>
</html>