---
import Layout from '../../layouts/Layout.astro';
import productos from '../../data/productos.json';

export async function getStaticPaths() {
  return productos.map((prod) => ({
    params: { id: prod.id },
    props: { prod },
  }));
}

const { prod } = Astro.props;

const productTitle = `${prod.nombre} | CamiZonas`;
const productDescription = `${prod.nombre} - Versi√≥n Fan desde Q.${prod.precioFan}. Personalizaci√≥n gratis. Env√≠o a toda Guatemala.`;
const productImage = prod.imagenesFan ? prod.imagenesFan[0] : prod.imagen;
const productUrl = `https://camizonas.com/producto/${prod.id}`;
---

<Layout 
  title={productTitle}
  description={productDescription}
  image={productImage}
  url={productUrl}
>
  <script type="application/ld+json" slot="head" set:html={JSON.stringify({
    "@context": "https://schema.org/",
    "@type": "Product",
    "name": prod.nombre,
    "image": [
      prod.imagenesFan?.[0] || prod.imagen,
      prod.imagenesFan?.[1] || prod.imagen,
      prod.imagenesJugador?.[0] || prod.imagen
    ],
    "description": `Camiseta ${prod.nombre}. Disponible en versi√≥n Fan y Jugador. Personalizaci√≥n incluida.`,
    "sku": prod.id,
    "brand": {
      "@type": "Brand",
      "name": "CamiZonas"
    },
    "offers": {
      "@type": "AggregateOffer",
      "url": productUrl,
      "priceCurrency": "GTQ",
      "lowPrice": prod.precioFan,
      "highPrice": prod.precioJugador || prod.precioFan,
      "offerCount": prod.precioJugador ? "2" : "1",
      "availability": "https://schema.org/InStock",
      "seller": {
        "@type": "Organization",
        "name": "CamiZonas"
      }
    },
    "category": prod.categoria,
    "aggregateRating": {
      "@type": "AggregateRating",
      "ratingValue": "4.9",
      "reviewCount": "127"
    }
  })} />

  <main class="bg-white min-h-screen pb-32 md:pb-0 md:grid md:grid-cols-2 md:gap-8 md:max-w-6xl md:mx-auto md:items-start md:pt-10">
    
    <nav class="absolute top-0 w-full z-20 p-6 flex justify-between items-center md:static md:col-span-2 md:px-0 md:mb-4">
      <a href="/" class="w-10 h-10 bg-white/80 backdrop-blur-md rounded-full flex items-center justify-center shadow-sm text-xl hover:scale-105 transition-transform border border-gray-100">‚Üê</a>
    </nav>

    <div class="relative w-full bg-[#F4F4F4] overflow-hidden md:rounded-3xl md:aspect-square md:sticky md:top-24">
        
        <div class="absolute top-18 right-12 md:top-10 md:right-10 pointer-events-none z-30">
            <span id="contador-fan" class="text-[10px] font-bold bg-black/80 text-white px-3 py-1.5 rounded-full backdrop-blur-md border border-white/10 shadow-sm flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
                1 / {prod.imagenesFan.length}
            </span>
        </div>

        <section id="slider-fan" class="slider-container relative w-full h-[500px] md:h-full transition-opacity duration-300 ease-out opacity-100 z-10">
            <div class="snap-container-fan flex overflow-x-auto snap-x snap-mandatory no-scrollbar h-full w-full">
                {prod.imagenesFan.map((img, index) => (
                <div class="slider-item-fan min-w-full h-full snap-center flex items-center justify-center p-8 pt-16 md:p-12">
                    <img 
                        src={img} 
                        class="w-full h-full object-contain drop-shadow-[0_20px_50px_rgba(0,0,0,0.15)]" 
                        alt={`${prod.nombre} - Versi√≥n Fan ${index + 1}`}
                        loading={index === 0 ? "eager" : "lazy"} 
                        decoding="async"
                        data-index={index + 1}
                    />
                </div>
                ))}
            </div>
            <div class="absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-2">
                {prod.imagenesFan.map(() => <div class="h-1.5 w-1.5 rounded-full bg-black/20"></div>)}
            </div>
            <div class="absolute bottom-6 left-1/2 -translate-x-1/2 md:bottom-10">
                 <span class="text-[9px] font-black bg-white/90 text-black px-3 py-1 rounded-full tracking-widest border border-gray-200 backdrop-blur-sm shadow-sm">VERSION FAN</span>
            </div>
        </section>

        {prod.precioJugador && (
            <>
                <div class="absolute top-18 right-12 md:top-10 md:right-10 pointer-events-none z-30">
                    <span id="contador-jugador" class="text-[10px] font-bold bg-black/80 text-white px-3 py-1.5 rounded-full backdrop-blur-md border border-white/10 shadow-sm flex items-center gap-1 opacity-0 transition-opacity duration-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="opacity-70"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
                        1 / {prod.imagenesJugador.length}
                    </span>
                </div>

                <section id="slider-jugador" class="slider-container absolute inset-0 w-full h-[500px] md:h-full transition-opacity duration-300 ease-out opacity-0 z-0 pointer-events-none">
                    <div class="snap-container-jugador flex overflow-x-auto snap-x snap-mandatory no-scrollbar h-full w-full">
                        {prod.imagenesJugador.map((img, index) => (
                            <div class="slider-item-jugador min-w-full h-full snap-center flex items-center justify-center p-8 pt-16 md:p-12">
                                <img 
                                    src={img} 
                                    class="w-full h-full object-contain drop-shadow-[0_20px_50px_rgba(0,0,0,0.2)]" 
                                    alt={`${prod.nombre} - Versi√≥n Jugador ${index + 1}`}
                                    loading="lazy" 
                                    decoding="async"
                                    data-index={index + 1}
                                />
                            </div>
                        ))}
                    </div>
                    <div class="absolute bottom-6 left-1/2 -translate-x-1/2 md:bottom-10">
                        <span class="text-[9px] font-black bg-black text-white px-3 py-1 rounded-full tracking-widest border border-white/20 backdrop-blur-sm shadow-xl">VERSION JUGADOR</span>
                    </div>
                </section>
            </>
        )}
    </div>

    <div class="p-6 flex flex-col gap-6 -mt-4 relative z-20 bg-white rounded-t-[30px] md:mt-0 md:rounded-none md:p-0 md:pl-8">
      
      <div class="flex justify-between items-start border-b border-gray-50 pb-6 md:border-none">
        <h1 class="text-2xl md:text-4xl font-black italic uppercase tracking-tighter w-2/3 leading-none text-[#1a1a1a]">{prod.nombre}</h1>
        <div class="text-right">
             <p class="text-2xl md:text-3xl font-black text-black transition-all duration-300" id="precio-display">Q.{prod.precioFan}</p>
             <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wide">Precio Base</span>
        </div>
      </div>

      {prod.precioJugador && (
        <div class="bg-gray-50 p-1.5 rounded-2xl flex relative border border-gray-100">
            <button 
                class="flex-1 py-3 md:py-4 rounded-xl text-xs md:text-sm font-black uppercase tracking-wide transition-all duration-300 bg-white shadow-sm text-black border border-gray-100"
                id="btn-fan"
            >
                Versi√≥n Fan
            </button>
            <button 
                class="flex-1 py-3 md:py-4 rounded-xl text-xs md:text-sm font-black uppercase tracking-wide transition-all duration-300 text-gray-400 hover:text-gray-600 bg-transparent"
                id="btn-jugador"
            >
                Versi√≥n Jugador
            </button>
        </div>
      )}

      <div class="space-y-3 pt-2">
         <div class="flex items-center gap-2">
            <span class="text-[10px] font-black uppercase tracking-widest text-gray-400">Personalizaci√≥n</span>
            <span class="bg-blue-50 text-blue-600 text-[9px] font-bold px-2 py-0.5 rounded border border-blue-100">GRATIS</span>
         </div>
         
         <div class="grid grid-cols-3 gap-3">
             <div class="col-span-2">
                 <input type="text" id="input-nombre" placeholder="Nombre (Ej. MESSI)" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm font-bold placeholder:font-medium placeholder:text-gray-400 outline-none focus:border-black focus:ring-1 ring-black transition-all uppercase" />
             </div>
             <div class="col-span-1">
                 <input type="number" id="input-numero" placeholder="#" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3 text-sm font-bold placeholder:font-medium placeholder:text-gray-400 outline-none focus:border-black focus:ring-1 ring-black transition-all text-center" />
             </div>
         </div>
      </div>

      <div class="space-y-3 pt-2">
   <div class="pt-2">
       <label class="text-[10px] font-black uppercase tracking-widest text-gray-400 block mb-3">Parche Oficial (+Q.25)</label>
       
       <div class="flex gap-3 items-start">
         <div class="relative flex-1">
           <button type="button" id="parche-toggle" class="w-full bg-gray-50 border border-gray-200 rounded-xl px-4 py-3.5 text-xs font-bold outline-none hover:border-black transition-all flex items-center justify-between group">
             <span id="parche-selected" class="uppercase text-gray-400 group-hover:text-black transition-colors">Sin Parche</span>
             <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="transition-transform duration-200" id="parche-arrow">
               <path d="m6 9 6 6 6-6"/>
             </svg>
           </button>

           <!-- Overlay para mobile -->
           <div id="dropdown-overlay" class="fixed inset-0 bg-black/20 backdrop-blur-sm z-[9998] opacity-0 invisible transition-all duration-300 md:hidden"></div>

           <!-- Dropdown CORREGIDO -->
           <div id="parche-dropdown" class="absolute top-full left-0 w-full mt-2 bg-white border border-gray-200 rounded-2xl shadow-2xl z-[9999] opacity-0 invisible translate-y-2 transition-all duration-300 overflow-hidden md:relative md:z-50">
             <div class="p-2 space-y-1 max-h-60 md:max-h-80 overflow-y-auto">
               <button type="button" class="parche-option w-full text-left px-4 py-3.5 rounded-xl hover:bg-gray-50 transition-colors flex items-center justify-between group" data-value="">
                 <div class="flex items-center gap-3">
                   <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center">
                     <span class="text-lg">‚ùå</span>
                   </div>
                   <div>
                     <p class="text-xs font-bold text-gray-700 group-hover:text-black">Sin Parche</p>
                     <p class="text-[10px] text-gray-400">Camiseta b√°sica</p>
                   </div>
                 </div>
                 <span class="text-xs font-bold text-green-600">Gratis</span>
               </button>

               <button type="button" class="parche-option w-full text-left px-4 py-3.5 rounded-xl hover:bg-blue-50 transition-colors flex items-center justify-between group" data-value="Champions">
                 <div class="flex items-center gap-3">
                   <div class="w-8 h-8 bg-blue-50 rounded-lg overflow-hidden flex items-center justify-center">
                     <img src="/img/parches/UEFAparche.webp" alt="Champions" class="w-full h-full object-cover" />
                   </div>
                   <div>
                     <p class="text-xs font-bold text-gray-700 group-hover:text-blue-600">Champions League</p>
                     <p class="text-[10px] text-gray-400">UEFA Official</p>
                   </div>
                 </div>
                 <span class="text-xs font-bold text-gray-500">+Q.25</span>
               </button>

               <button type="button" class="parche-option w-full text-left px-4 py-3.5 rounded-xl hover:bg-orange-50 transition-colors flex items-center justify-between group" data-value="La Liga">
                 <div class="flex items-center gap-3">
                   <div class="w-8 h-8 bg-orange-50 rounded-lg overflow-hidden flex items-center justify-center">
                     <img src="/img/parches/LALIGAparche.webp" alt="La Liga" class="w-full h-full object-cover" />
                   </div>
                   <div>
                     <p class="text-xs font-bold text-gray-700 group-hover:text-orange-600">La Liga</p>
                     <p class="text-[10px] text-gray-400">Espa√±a Official</p>
                   </div>
                 </div>
                 <span class="text-xs font-bold text-gray-500">+Q.25</span>
               </button>

               <button type="button" class="parche-option w-full text-left px-4 py-3.5 rounded-xl hover:bg-purple-50 transition-colors flex items-center justify-between group" data-value="Premier">
                 <div class="flex items-center gap-3">
                   <div class="w-8 h-8 bg-purple-50 rounded-lg overflow-hidden flex items-center justify-center">
                     <img src="/img/parches/PREMIERparche.webp" alt="Premier" class="w-full h-full object-cover" />
                   </div>
                   <div>
                     <p class="text-xs font-bold text-gray-700 group-hover:text-purple-600">Premier League</p>
                     <p class="text-[10px] text-gray-400">England Official</p>
                   </div>
                 </div>
                 <span class="text-xs font-bold text-gray-500">+Q.25</span>
               </button>

               <button type="button" class="parche-option w-full text-left px-4 py-3.5 rounded-xl hover:bg-yellow-50 transition-colors flex items-center justify-between group" data-value="Mundial">
                 <div class="flex items-center gap-3">
                   <div class="w-8 h-8 bg-yellow-50 rounded-lg overflow-hidden flex items-center justify-center">
                     <img src="/img/parches/FIFA parche.webp" alt="Mundial" class="w-full h-full object-cover" />
                   </div>
                   <div>
                     <p class="text-xs font-bold text-gray-700 group-hover:text-yellow-600">Campe√≥n Mundial</p>
                     <p class="text-[10px] text-gray-400">FIFA Official</p>
                   </div>
                 </div>
                 <span class="text-xs font-bold text-gray-500">+Q.25</span>
               </button>
             </div>
           </div>
         </div>

         <div id="parche-preview-container" class="w-16 h-16 bg-gray-50 rounded-xl border border-dashed border-gray-300 flex items-center justify-center overflow-hidden transition-all duration-300 flex-shrink-0">
           <svg id="parche-placeholder" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-300">
             <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
           </svg>
           <img id="parche-img" src="" class="w-full h-full object-contain p-2 hidden opacity-0 transition-opacity duration-300" alt="Parche" />
         </div>
       </div>
   </div>
</div>

      <div class="space-y-3">
        <span class="text-[10px] font-black uppercase tracking-widest text-gray-400">Talla</span>
        <div class="flex justify-between gap-2">
          {['S', 'M', 'L', 'XL', 'XXL'].map(talla => (
            <button class="size-btn w-full h-12 md:h-14 rounded-xl border border-gray-200 text-sm font-bold flex items-center justify-center hover:border-black hover:bg-gray-50 transition-all">
              {talla}
            </button>
          ))}
        </div>
      </div>

      <div id="sticky-whatsapp" class="fixed bottom-24 left-0 w-full px-6 z-[60] max-w-[375px] mx-auto right-0 transition-transform duration-300 transform translate-y-0 md:static md:p-0 md:bg-transparent md:border-none md:mt-8 md:transform-none">
        <div class="flex gap-3">
          <button id="whatsapp-btn" class="flex-1 bg-[#121212] text-white h-14 md:h-16 rounded-2xl font-bold flex items-center justify-center gap-3 shadow-[0_10px_30px_rgba(0,0,0,0.3)] hover:shadow-2xl hover:scale-[1.01] active:scale-95 transition-all duration-200">
            <span class="bg-white/10 rounded-full p-2 flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22" fill="#25D366" class="flex-shrink-0">
                <path d="M12 2C6.486 2 2 6.486 2 12c0 1.994.574 3.84 1.566 5.396L2 22l4.78-1.538A9.93 9.93 0 0 0 12 22c5.514 0 10-4.486 10-10S17.514 2 12 2zm0 18.182a8.13 8.13 0 0 1-4.144-1.127l-.297-.176-2.834.911.923-2.761-.194-.306A8.126 8.126 0 1 1 12 20.182zm4.47-5.693c-.244-.122-1.444-.713-1.667-.794-.223-.082-.386-.122-.549.122-.163.245-.632.794-.774.958-.142.163-.284.183-.528.061-.244-.122-1.03-.38-1.96-1.21-.724-.646-1.212-1.444-1.354-1.688-.142-.244-.015-.375.107-.497.11-.11.244-.285.366-.427.122-.143.163-.244.244-.407.081-.163.041-.305-.02-.427-.061-.122-.549-1.326-.752-1.815-.198-.476-.399-.412-.549-.42-.142-.007-.305-.009-.467-.009-.163 0-.427.061-.651.305-.223.244-.854.834-.854 2.034s.875 2.36.997 2.523c.122.163 1.72 2.628 4.168 3.684.582.251 1.037.401 1.391.513.584.186 1.115.16 1.535.097.468-.07 1.444-.591 1.647-1.163.203-.571.203-1.061.142-1.163-.061-.102-.223-.163-.467-.285z"/>
              </svg>
            </span>
            <span>Pedir Ahora</span>
          </button>

          <button id="add-to-cart" class="w-14 h-14 md:h-16 border-2 border-black rounded-2xl flex items-center justify-center hover:bg-black hover:text-white transition-all duration-200 group shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="group-hover:stroke-white transition-colors">
              <circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/>
              <path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </main>
</Layout>

<script define:vars={{ 
  precioBase: prod.precioFan, 
  precioJugador: prod.precioJugador, 
  nombreProd: prod.nombre, 
  totalFan: prod.imagenesFan.length, 
  totalJugador: prod.imagenesJugador ? prod.imagenesJugador.length : 0 
}}>
  // ‚úÖ VARIABLES AHORA CORRECTAS
  let versionActual = 'Fan';
  let precioActual = precioBase;
  let tallaActual = '';
  let parcheSeleccionado = '';

  const parcheToggle = document.getElementById('parche-toggle');
  const parcheDropdown = document.getElementById('parche-dropdown');
  const parcheSelected = document.getElementById('parche-selected');
  const parcheArrow = document.getElementById('parche-arrow');
  const parcheOptions = document.querySelectorAll('.parche-option');
  const parcheContainer = document.getElementById('parche-preview-container');
  const parcheImg = document.getElementById('parche-img');
  const parchePlaceholder = document.getElementById('parche-placeholder');

  const imagenesParches = {
    'Champions': '/img/parches/UEFAparche.webp',
    'La Liga': '/img/parches/LALIGAparche.webp',
    'Premier': '/img/parches/PREMIERparche.webp',
    'Mundial': '/img/parches/FIFA parche.webp'
  };

  const nombresParches = {
    'Champions': 'Champions League',
    'La Liga': 'La Liga',
    'Premier': 'Premier League',
    'Mundial': 'Campe√≥n Mundial'
  };

  // ‚úÖ DROPDOWN MEJORADO
  parcheToggle?.addEventListener('click', (e) => {
    e.stopPropagation();
    const isOpen = !parcheDropdown.classList.contains('invisible');
    
    if (isOpen) {
      parcheDropdown.classList.add('opacity-0', 'invisible', 'translate-y-2');
      parcheArrow.style.transform = 'rotate(0deg)';
      document.body.style.overflow = ''; // Restaurar scroll
    } else {
      parcheDropdown.classList.remove('opacity-0', 'invisible', 'translate-y-2');
      parcheArrow.style.transform = 'rotate(180deg)';
      document.body.style.overflow = 'hidden'; // Bloquear scroll en mobile
    }
  });

  document.addEventListener('click', (e) => {
    if (!parcheToggle?.contains(e.target) && !parcheDropdown?.contains(e.target)) {
      parcheDropdown?.classList.add('opacity-0', 'invisible', 'translate-y-2');
      if (parcheArrow) parcheArrow.style.transform = 'rotate(0deg)';
      document.body.style.overflow = '';
    }
  });

  parcheOptions.forEach(option => {
    option.addEventListener('click', (e) => {
      e.stopPropagation();
      const valor = option.getAttribute('data-value');
      parcheSeleccionado = valor;
      
      if (valor) {
        parcheSelected.textContent = nombresParches[valor];
        parcheSelected.classList.remove('text-gray-400');
        parcheSelected.classList.add('text-black');
      } else {
        parcheSelected.textContent = 'Sin Parche';
        parcheSelected.classList.add('text-gray-400');
        parcheSelected.classList.remove('text-black');
      }

      const rutaImagen = imagenesParches[valor];
      if (valor && rutaImagen) {
        parcheImg.src = rutaImagen;
        parcheImg.classList.remove('hidden');
        setTimeout(() => parcheImg.classList.remove('opacity-0'), 10);
        
        parchePlaceholder.classList.add('hidden');
        parcheContainer.classList.remove('border-dashed', 'bg-gray-50');
        parcheContainer.classList.add('border-solid', 'border-black', 'bg-white');
      } else {
        parcheImg.classList.add('opacity-0');
        setTimeout(() => parcheImg.classList.add('hidden'), 300);
        
        parchePlaceholder.classList.remove('hidden');
        parcheContainer.classList.add('border-dashed', 'bg-gray-50');
        parcheContainer.classList.remove('border-solid', 'border-black', 'bg-white');
      }

      parcheDropdown.classList.add('opacity-0', 'invisible', 'translate-y-2');
      if (parcheArrow) parcheArrow.style.transform = 'rotate(0deg)';
      document.body.style.overflow = '';
    });
  });

  const setupCounter = (containerClass, counterId, totalImages) => {
    const container = document.querySelector(`.${containerClass}`);
    const counterElement = document.getElementById(counterId);
    if (!container || !counterElement) return;

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target.querySelector('img');
          const index = img?.getAttribute('data-index');
          const svgIcon = counterElement.querySelector('svg')?.outerHTML || '';
          if (index) counterElement.innerHTML = `${svgIcon} ${index} / ${totalImages}`;
        }
      });
    }, { root: container, threshold: 0.6 });

    container.querySelectorAll('.slider-item-fan, .slider-item-jugador').forEach(item => observer.observe(item));
  };

  function cambiarVersion(version) {
    versionActual = version;
    precioActual = (version === 'Fan') ? precioBase : (precioJugador || precioBase);
    
    const precioDisplay = document.getElementById('precio-display');
    if (precioDisplay) precioDisplay.innerText = `Q.${precioActual}`;

    const sliderFan = document.getElementById('slider-fan');
    const sliderJugador = document.getElementById('slider-jugador');
    const btnFan = document.getElementById('btn-fan');
    const btnJugador = document.getElementById('btn-jugador');
    const contadorFan = document.getElementById('contador-fan');
    const contadorJugador = document.getElementById('contador-jugador');
    
    if(version === 'Fan') {
      sliderFan?.classList.remove('opacity-0', 'pointer-events-none');
      sliderFan?.classList.add('opacity-100', 'z-10');
      contadorFan?.classList.remove('opacity-0');
      contadorFan?.classList.add('opacity-100');
      
      if(sliderJugador) {
        sliderJugador.classList.remove('opacity-100', 'z-10');
        sliderJugador.classList.add('opacity-0', 'pointer-events-none');
      }
      if(contadorJugador) {
        contadorJugador.classList.remove('opacity-100');
        contadorJugador.classList.add('opacity-0');
      }
      
      if (btnFan) btnFan.className = "flex-1 py-3 md:py-4 rounded-xl text-xs md:text-sm font-black uppercase tracking-wide transition-all duration-300 bg-white shadow-sm text-black border border-gray-100";
      if (btnJugador) btnJugador.className = "flex-1 py-3 md:py-4 rounded-xl text-xs md:text-sm font-black uppercase tracking-wide transition-all duration-300 text-gray-400 hover:text-gray-600 bg-transparent";
    } else {
      if(sliderJugador) {
        sliderJugador.classList.remove('opacity-0', 'pointer-events-none');
        sliderJugador.classList.add('opacity-100', 'z-10');
      }
      if(contadorJugador) {
        contadorJugador.classList.remove('opacity-0');
        contadorJugador.classList.add('opacity-100');
      }
      
      sliderFan?.classList.remove('opacity-100', 'z-10');
      sliderFan?.classList.add('opacity-0', 'pointer-events-none');
      contadorFan?.classList.remove('opacity-100');
      contadorFan?.classList.add('opacity-0');
      
      if (btnJugador) btnJugador.className = "flex-1 py-3 md:py-4 rounded-xl text-xs md:text-sm font-black uppercase tracking-wide transition-all duration-300 bg-white shadow-sm text-black border border-gray-100";
      if (btnFan) btnFan.className = "flex-1 py-3 md:py-4 rounded-xl text-xs md:text-sm font-black uppercase tracking-wide transition-all duration-300 text-gray-400 hover:text-gray-600 bg-transparent";
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    setupCounter('snap-container-fan', 'contador-fan', totalFan);
    if (totalJugador > 0) {
      setupCounter('snap-container-jugador', 'contador-jugador', totalJugador);
    }
  });

  const btnFan = document.getElementById('btn-fan');
  const btnJugador = document.getElementById('btn-jugador');

  btnFan?.addEventListener('click', () => cambiarVersion('Fan'));
  btnJugador?.addEventListener('click', () => cambiarVersion('Jugador'));

  let lastScrollY = window.scrollY;
  const whatsappContainer = document.getElementById('sticky-whatsapp');

  window.addEventListener('scroll', () => {
    const currentScrollY = window.scrollY;
    if (window.innerWidth < 768) {
      if (currentScrollY > lastScrollY && currentScrollY > 50) {
        if (whatsappContainer) whatsappContainer.style.transform = 'translateY(200%)';
      } else {
        if (whatsappContainer) whatsappContainer.style.transform = 'translateY(0)';
      }
    }
    lastScrollY = currentScrollY;
  });

  const botonesTalla = document.querySelectorAll('.size-btn');
  botonesTalla.forEach(btn => {
    btn.addEventListener('click', (e) => {
      botonesTalla.forEach(b => {
        b.classList.remove('bg-black', 'text-white', 'border-black');
        b.classList.add('border-gray-200');
      });
      e.target.classList.remove('border-gray-200');
      e.target.classList.add('bg-black', 'text-white', 'border-black');
      tallaActual = e.target.innerText;
    });
  });

  document.getElementById('whatsapp-btn')?.addEventListener('click', () => {
    const telefono = "502XXXXXXXX";
    const nombrePers = document.getElementById('input-nombre')?.value.toUpperCase();
    const numeroPers = document.getElementById('input-numero')?.value;
    
    let extraTexto = '';
    let precioFinal = precioActual;

    if(nombrePers || numeroPers) {
      extraTexto += `\n‚ú® Personalizado: *${nombrePers}* #${numeroPers}`;
    }
    if(parcheSeleccionado) {
      const nombreParche = nombresParches[parcheSeleccionado];
      extraTexto += `\nüõ°Ô∏è Parche: *${nombreParche}* (+Q.25)`;
      precioFinal += 25;
    }

    const mensaje = `Hola üëã, quiero pedir: \n\n‚öΩ *${nombreProd}*\nüíé Versi√≥n: *${versionActual.toUpperCase()}*\nüìè Talla: ${tallaActual || 'Por definir'}${extraTexto}\n\nüí∞ Precio Total: Q.${precioFinal}`;
    window.open(`https://wa.me/${telefono}?text=${encodeURIComponent(mensaje)}`, '_blank');
  });

  document.getElementById('add-to-cart')?.addEventListener('click', () => {
    if (!tallaActual) {
      alert('Por favor selecciona una talla');
      return;
    }

    const nombrePers = document.getElementById('input-nombre')?.value.toUpperCase();
    const numeroPers = document.getElementById('input-numero')?.value;

    let precioFinal = precioActual;
    if (parcheSeleccionado) precioFinal += 25;

    const productoCarrito = {
      id: `${nombreProd}-${Date.now()}`,
      nombre: nombreProd,
      version: versionActual,
      precio: precioFinal,
      talla: tallaActual,
      imagen: versionActual === 'Fan' 
        ? document.querySelector('.snap-container-fan img')?.src 
        : document.querySelector('.snap-container-jugador img')?.src,
      personalizacion: {
        nombre: nombrePers || '',
        numero: numeroPers || ''
      },
      parche: parcheSeleccionado || null
    };

    let carrito = JSON.parse(localStorage.getItem('carrito') || '[]');
    carrito.push(productoCarrito);
    localStorage.setItem('carrito', JSON.stringify(carrito));

    const btn = document.getElementById('add-to-cart');
    if (btn) {
      const originalHTML = btn.innerHTML;
      
      btn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"/>
        </svg>
      `;
      btn.classList.add('bg-green-500', 'border-green-500', 'text-white');

      setTimeout(() => {
        btn.innerHTML = originalHTML;
        btn.classList.remove('bg-green-500', 'border-green-500', 'text-white');
      }, 1500);
    }

    window.dispatchEvent(new Event('cartUpdated'));
    mostrarNotificacion(' Agregado al carrito');
  });

  function mostrarNotificacion(mensaje) {
    const notif = document.createElement('div');
    notif.className = 'fixed top-24 left-1/2 -translate-x-1/2 bg-black text-white px-6 py-3 rounded-full font-bold text-sm shadow-2xl z-[100] animate-bounce';
    notif.textContent = mensaje;
    document.body.appendChild(notif);
    
    setTimeout(() => {
      notif.remove();
    }, 2000);
  }
</script>